<%- include('../partials/header', { title: 'Time Entry Details' }) %>

<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3">Time Entry Details</h1>
    <div class="d-flex gap-2">
      <% if (!timeEntry.approved) { %>
        <a href="/time-entries/<%= timeEntry._id %>/edit" class="btn btn-outline-primary">Edit</a>
        <% if (req.user && req.user.role === 'admin') { %>
          <form action="/time-entries/<%= timeEntry._id %>/approve" method="POST" class="d-inline">
            <button type="submit" class="btn btn-success">Approve</button>
          </form>
        <% } %>
      <% } %>
      <a href="/time-entries" class="btn btn-outline-secondary">Back to Time Entries</a>
    </div>
  </div>

  <div class="row">
    <div class="col-md-8">
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Time Entry Information</h5>
          <div class="row">
            <div class="col-md-6">
              <p><strong>Employee:</strong> 
                <% if (timeEntry.employee) { %>
                  <a href="/employees/<%= timeEntry.employee._id %>">
                    <%= timeEntry.employee.firstName %> <%= timeEntry.employee.lastName %>
                  </a>
                <% } else { %>
                  Unknown
                <% } %>
              </p>
              <p><strong>Date:</strong> <%= timeEntry.date ? (() => { const d = new Date(timeEntry.date); return (d.getUTCMonth() + 1) + '/' + d.getUTCDate() + '/' + d.getUTCFullYear(); })() : '-' %></p>
              <% if (timeEntry.startTime && timeEntry.endTime) { %>
                <p><strong>Time:</strong> 
                  <%= new Date(timeEntry.startTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %> - 
                  <%= new Date(timeEntry.endTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %>
                </p>
              <% } %>
              <p><strong>Hours Worked:</strong> <%= (timeEntry.hoursWorked || 0).toFixed(2) %></p>
              <p><strong>Break Minutes:</strong> <%= timeEntry.breakMinutes || 0 %></p>
            </div>
            <div class="col-md-6">
              <p><strong>Overtime Hours:</strong> <%= (timeEntry.overtimeHours || 0).toFixed(2) %></p>
              <p><strong>Type:</strong> 
                <span class="badge bg-<%= timeEntry.type === 'pto' || timeEntry.type === 'sick' ? 'info' : timeEntry.type === 'holiday' ? 'warning' : 'primary' %>">
                  <%= timeEntry.type %>
                </span>
              </p>
              <p><strong>Status:</strong> 
                <span class="badge bg-<%= timeEntry.approved ? 'success' : 'warning' %>">
                  <%= timeEntry.approved ? 'Approved' : 'Pending Approval' %>
                </span>
              </p>
              <% if (timeEntry.approved && timeEntry.approvedBy) { %>
                <p><strong>Approved By:</strong> <%= timeEntry.approvedBy.name %></p>
              <% } %>
              <% if (timeEntry.jobName) { %>
                <p><strong>Job/Project:</strong> <%= timeEntry.jobName %></p>
              <% } %>
            </div>
          </div>
          <% if (timeEntry.notes) { %>
            <div class="mt-3">
              <strong>Notes:</strong>
              <p class="text-muted"><%= timeEntry.notes %></p>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>

