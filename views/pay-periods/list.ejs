<%- include('../partials/header', { title: 'Pay Periods' }) %>

<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3">Pay Periods</h1>
    <a href="/pay-periods/new" class="btn btn-primary">
      <i class="bi bi-plus-circle"></i> New Pay Period
    </a>
  </div>

  <!-- Filters -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="GET" action="/pay-periods" class="row g-3">
        <div class="col-md-3">
          <select class="form-select" name="status">
            <option value="">All Statuses</option>
            <option value="open" <%= statusFilter === 'open' ? 'selected' : '' %>>Open</option>
            <option value="locked" <%= statusFilter === 'locked' ? 'selected' : '' %>>Locked</option>
            <option value="processed" <%= statusFilter === 'processed' ? 'selected' : '' %>>Processed</option>
          </select>
        </div>
        <div class="col-md-2">
          <button type="submit" class="btn btn-primary w-100">
            <i class="bi bi-search"></i> Filter
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Name</th>
          <th>Start Date</th>
          <th>End Date</th>
          <th>Status</th>
          <th>Employees</th>
          <th>Total Hours</th>
          <th>Total Gross Pay</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if (payPeriods && payPeriods.length > 0) { %>
          <% payPeriods.forEach(period => { %>
            <tr>
              <td>
                <a href="/pay-periods/<%= period._id %>" class="text-decoration-none">
                  <%= period.name %>
                </a>
              </td>
              <td>
                <%= period.startDate ? (() => { const d = new Date(period.startDate); return (d.getUTCMonth() + 1) + '/' + d.getUTCDate() + '/' + d.getUTCFullYear(); })() : '-' %>
              </td>
              <td>
                <%= period.endDate ? (() => { const d = new Date(period.endDate); return (d.getUTCMonth() + 1) + '/' + d.getUTCDate() + '/' + d.getUTCFullYear(); })() : '-' %>
              </td>
              <td>
                <% 
                  let statusClass = 'secondary';
                  if (period.status === 'open') statusClass = 'success';
                  else if (period.status === 'locked') statusClass = 'warning';
                  else if (period.status === 'processed') statusClass = 'info';
                %>
                <span class="badge bg-<%= statusClass %>"><%= period.status %></span>
              </td>
              <td><%= period.totalEmployees || 0 %></td>
              <td><%= (period.totalHours || 0).toFixed(2) %></td>
              <td>$<%= (period.totalGrossPay || 0).toFixed(2) %></td>
              <td>
                <a href="/pay-periods/<%= period._id %>" class="btn btn-sm btn-outline-primary">View</a>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="8" class="text-center text-muted">No pay periods found</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <% if (typeof totalPages !== 'undefined' && totalPages > 1) { %>
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <% if (currentPage > 1) { %>
          <li class="page-item">
            <a class="page-link" href="?page=<%= currentPage - 1 %><%= statusFilter ? '&status=' + statusFilter : '' %>">Previous</a>
          </li>
        <% } %>
        <% for (let i = 1; i <= totalPages; i++) { %>
          <li class="page-item <%= i === currentPage ? 'active' : '' %>">
            <a class="page-link" href="?page=<%= i %><%= statusFilter ? '&status=' + statusFilter : '' %>"><%= i %></a>
          </li>
        <% } %>
        <% if (currentPage < totalPages) { %>
          <li class="page-item">
            <a class="page-link" href="?page=<%= currentPage + 1 %><%= statusFilter ? '&status=' + statusFilter : '' %>">Next</a>
          </li>
        <% } %>
      </ul>
    </nav>
  <% } %>
</div>

<%- include('../partials/footer') %>

