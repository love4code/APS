<%- include('../partials/header', { title: customer.name }) %>

<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3"><%= customer.name %></h1>
    <div>
      <a
        href="/customers/<%= customer._id %>/edit"
        class="btn btn-outline-primary"
        >Edit</a
      >
      <form
        action="/customers/<%= customer._id %>/delete"
        method="POST"
        class="d-inline"
        onsubmit="return confirm('Delete this customer? This will fail if customer has jobs.')"
      >
        <button type="submit" class="btn btn-outline-danger">Delete</button>
      </form>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Contact Information</h5>
          <p><strong>Phone:</strong> <%= customer.phone || 'N/A' %></p>
          <p><strong>Email:</strong> <%= customer.email || 'N/A' %></p>
          <p><strong>Address:</strong> <%= customer.address || 'N/A' %></p>
          <% if (customer.notes) { %>
          <div class="mt-3">
            <strong>Notes:</strong>
            <p class="text-muted"><%= customer.notes %></p>
          </div>
          <% } %>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Jobs (<%= jobs ? jobs.length : 0 %>)</h5>
          <% if (jobs && jobs.length > 0) { %>
          <div class="list-group">
            <% jobs.forEach(job => { %>
            <a
              href="/jobs/<%= job._id %>"
              class="list-group-item list-group-item-action"
            >
              <div class="d-flex justify-content-between">
                <div>
                  <strong>Job #<%= job._id.toString().slice(-6) %></strong>
                  <span
                    class="badge bg-<%= job.status === 'complete' ? 'success' : job.status === 'delayed' ? 'warning' : 'secondary' %> ms-2"
                  >
                    <%= job.status %>
                  </span>
                </div>
                <div class="text-end">
                  <div>$<%= (job.totalPrice || 0).toFixed(2) %></div>
                  <small class="text-muted"
                    ><%= new Date(job.createdAt).toLocaleDateString() %></small
                  >
                </div>
              </div>
            </a>
            <% }) %>
          </div>
          <% } else { %>
          <p class="text-muted">No jobs for this customer</p>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
