<%- include('../partials/header', { title: employee ? 'Edit Employee' : 'New Employee' }) %>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-10 mx-auto">
      <h1 class="h3 mb-4"><%= employee ? 'Edit Employee' : 'New Employee' %></h1>

      <form method="POST" action="<%= employee ? `/employees/${employee._id}` : '/employees' %>">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="firstName" class="form-label">First Name *</label>
            <input type="text" class="form-control" id="firstName" name="firstName" value="<%= employee ? employee.firstName : '' %>" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="lastName" class="form-label">Last Name *</label>
            <input type="text" class="form-control" id="lastName" name="lastName" value="<%= employee ? employee.lastName : '' %>" required>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="email" class="form-label">Email *</label>
            <input type="email" class="form-control" id="email" name="email" value="<%= employee ? employee.email : '' %>" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="phone" class="form-label">Phone</label>
            <input type="tel" class="form-control" id="phone" name="phone" value="<%= employee ? employee.phone : '' %>">
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="position" class="form-label">Position *</label>
            <input type="text" class="form-control" id="position" name="position" value="<%= employee ? employee.position : '' %>" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="department" class="form-label">Department *</label>
            <input type="text" class="form-control" id="department" name="department" value="<%= employee ? employee.department : '' %>" required>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="status" class="form-label">Status *</label>
            <select class="form-select" id="status" name="status" required>
              <option value="active" <%= employee && employee.status === 'active' ? 'selected' : '' %>>Active</option>
              <option value="inactive" <%= employee && employee.status === 'inactive' ? 'selected' : '' %>>Inactive</option>
              <option value="terminated" <%= employee && employee.status === 'terminated' ? 'selected' : '' %>>Terminated</option>
              <option value="on_leave" <%= employee && employee.status === 'on_leave' ? 'selected' : '' %>>On Leave</option>
            </select>
          </div>
          <div class="col-md-6 mb-3">
            <label for="hireDate" class="form-label">Hire Date *</label>
            <input type="date" class="form-control" id="hireDate" name="hireDate" value="<%= employee && employee.hireDate ? new Date(employee.hireDate).toISOString().split('T')[0] : '' %>" required>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="terminationDate" class="form-label">Termination Date</label>
            <input type="date" class="form-control" id="terminationDate" name="terminationDate" value="<%= employee && employee.terminationDate ? new Date(employee.terminationDate).toISOString().split('T')[0] : '' %>">
          </div>
          <div class="col-md-6 mb-3">
            <label for="payType" class="form-label">Pay Type *</label>
            <select class="form-select" id="payType" name="payType" required onchange="togglePayFields()">
              <option value="">Select...</option>
              <option value="hourly" <%= employee && employee.payType === 'hourly' ? 'selected' : '' %>>Hourly</option>
              <option value="salary" <%= employee && employee.payType === 'salary' ? 'selected' : '' %>>Salary</option>
            </select>
          </div>
        </div>

        <div class="row" id="hourlyFields" style="display: <%= employee && employee.payType === 'hourly' ? 'flex' : 'none' %>;">
          <div class="col-md-6 mb-3">
            <label for="hourlyRate" class="form-label">Hourly Rate *</label>
            <div class="input-group">
              <span class="input-group-text">$</span>
              <input type="number" class="form-control" id="hourlyRate" name="hourlyRate" step="0.01" min="0" value="<%= employee && employee.hourlyRate ? employee.hourlyRate : '' %>">
            </div>
          </div>
        </div>

        <div class="row" id="salaryFields" style="display: <%= employee && employee.payType === 'salary' ? 'flex' : 'none' %>;">
          <div class="col-md-6 mb-3">
            <label for="annualSalary" class="form-label">Annual Salary *</label>
            <div class="input-group">
              <span class="input-group-text">$</span>
              <input type="number" class="form-control" id="annualSalary" name="annualSalary" step="0.01" min="0" value="<%= employee && employee.annualSalary ? employee.annualSalary : '' %>">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="defaultOvertimeMultiplier" class="form-label">Overtime Multiplier</label>
            <input type="number" class="form-control" id="defaultOvertimeMultiplier" name="defaultOvertimeMultiplier" step="0.1" min="1" value="<%= employee ? (employee.defaultOvertimeMultiplier || 1.5) : '1.5' %>">
            <small class="form-text text-muted">Default: 1.5 (time and a half)</small>
          </div>
        </div>

        <div class="mb-3">
          <label for="notes" class="form-label">Notes</label>
          <textarea class="form-control" id="notes" name="notes" rows="4"><%= employee ? employee.notes : '' %></textarea>
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">Save Employee</button>
          <a href="<%= employee ? `/employees/${employee._id}` : '/employees' %>" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  function togglePayFields() {
    const payType = document.getElementById('payType').value;
    const hourlyFields = document.getElementById('hourlyFields');
    const salaryFields = document.getElementById('salaryFields');
    const hourlyRate = document.getElementById('hourlyRate');
    const annualSalary = document.getElementById('annualSalary');
    
    if (payType === 'hourly') {
      hourlyFields.style.display = 'flex';
      salaryFields.style.display = 'none';
      hourlyRate.required = true;
      annualSalary.required = false;
    } else if (payType === 'salary') {
      hourlyFields.style.display = 'none';
      salaryFields.style.display = 'flex';
      hourlyRate.required = false;
      annualSalary.required = true;
    } else {
      hourlyFields.style.display = 'none';
      salaryFields.style.display = 'none';
      hourlyRate.required = false;
      annualSalary.required = false;
    }
  }
  
  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    togglePayFields();
  });
</script>

<%- include('../partials/footer') %>

