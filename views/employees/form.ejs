<%- include('../partials/header', { title: employee ? 'Edit Employee' : 'New Employee' }) %>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-10 mx-auto">
      <h1 class="h3 mb-4"><%= employee ? 'Edit Employee' : 'New Employee' %></h1>

      <form method="POST" action="<%= employee ? `/employees/${employee._id}` : '/employees' %>">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="firstName" class="form-label">First Name *</label>
            <input type="text" class="form-control" id="firstName" name="firstName" value="<%= employee ? employee.firstName : '' %>" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="lastName" class="form-label">Last Name *</label>
            <input type="text" class="form-control" id="lastName" name="lastName" value="<%= employee ? employee.lastName : '' %>" required>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="email" class="form-label">Email *</label>
            <input type="email" class="form-control" id="email" name="email" value="<%= employee ? employee.email : '' %>" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="phone" class="form-label">Phone</label>
            <input type="tel" class="form-control" id="phone" name="phone" value="<%= employee ? employee.phone : '' %>">
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="position" class="form-label">Position *</label>
            <input type="text" class="form-control" id="position" name="position" value="<%= employee ? employee.position : '' %>" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="department" class="form-label">Department *</label>
            <input type="text" class="form-control" id="department" name="department" value="<%= employee ? employee.department : '' %>" required>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="status" class="form-label">Status *</label>
            <select class="form-select" id="status" name="status" required>
              <option value="active" <%= employee && employee.status === 'active' ? 'selected' : '' %>>Active</option>
              <option value="inactive" <%= employee && employee.status === 'inactive' ? 'selected' : '' %>>Inactive</option>
              <option value="terminated" <%= employee && employee.status === 'terminated' ? 'selected' : '' %>>Terminated</option>
              <option value="on_leave" <%= employee && employee.status === 'on_leave' ? 'selected' : '' %>>On Leave</option>
            </select>
          </div>
          <div class="col-md-6 mb-3">
            <label for="hireDate" class="form-label">Hire Date *</label>
            <input type="date" class="form-control" id="hireDate" name="hireDate" value="<%= employee && employee.hireDate ? (typeof employee.hireDate === 'string' && employee.hireDate.includes('-') ? employee.hireDate : new Date(employee.hireDate).toISOString().split('T')[0]) : '' %>" required>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="terminationDate" class="form-label">Termination Date</label>
            <input type="date" class="form-control" id="terminationDate" name="terminationDate" value="<%= employee && employee.terminationDate ? (typeof employee.terminationDate === 'string' && employee.terminationDate.includes('-') ? employee.terminationDate : new Date(employee.terminationDate).toISOString().split('T')[0]) : '' %>">
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Pay Type *</label>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="payTypeHourly" name="payType" value="hourly" onchange="togglePayFields()" <%= employee && (Array.isArray(employee.payType) ? employee.payType.includes('hourly') : employee.payType === 'hourly') ? 'checked' : '' %>>
              <label class="form-check-label" for="payTypeHourly">Hourly</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="payTypeSalary" name="payType" value="salary" onchange="togglePayFields()" <%= employee && (Array.isArray(employee.payType) ? employee.payType.includes('salary') : employee.payType === 'salary') ? 'checked' : '' %>>
              <label class="form-check-label" for="payTypeSalary">Salary</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="payTypePercentage" name="payType" value="percentage" onchange="togglePayFields()" <%= employee && (Array.isArray(employee.payType) ? employee.payType.includes('percentage') : employee.payType === 'percentage') ? 'checked' : '' %>>
              <label class="form-check-label" for="payTypePercentage">Percentage</label>
            </div>
          </div>
        </div>

        <div class="row" id="hourlyFields" style="display: <%= employee && (Array.isArray(employee.payType) ? employee.payType.includes('hourly') : employee.payType === 'hourly') ? 'flex' : 'none' %>;">
          <div class="col-md-6 mb-3">
            <label for="hourlyRate" class="form-label">Hourly Rate *</label>
            <div class="input-group">
              <span class="input-group-text">$</span>
              <input type="number" class="form-control" id="hourlyRate" name="hourlyRate" step="0.01" min="0" value="<%= employee && employee.hourlyRate ? employee.hourlyRate : '' %>">
            </div>
          </div>
        </div>

        <div class="row" id="salaryFields" style="display: <%= employee && (Array.isArray(employee.payType) ? employee.payType.includes('salary') : employee.payType === 'salary') ? 'flex' : 'none' %>;">
          <div class="col-md-6 mb-3">
            <label for="annualSalary" class="form-label">Annual Salary *</label>
            <div class="input-group">
              <span class="input-group-text">$</span>
              <input type="number" class="form-control" id="annualSalary" name="annualSalary" step="0.01" min="0" value="<%= employee && employee.annualSalary ? employee.annualSalary : '' %>">
            </div>
          </div>
        </div>

        <div class="row" id="percentageFields" style="display: <%= employee && (Array.isArray(employee.payType) ? employee.payType.includes('percentage') : employee.payType === 'percentage') ? 'flex' : 'none' %>;">
          <div class="col-md-6 mb-3">
            <label for="percentageRate" class="form-label">Percentage Rate *</label>
            <div class="input-group">
              <input type="number" class="form-control" id="percentageRate" name="percentageRate" step="0.01" min="0" max="100" value="<%= employee && employee.percentageRate ? employee.percentageRate : '' %>">
              <span class="input-group-text">%</span>
            </div>
            <small class="form-text text-muted">Enter percentage (0-100)</small>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="defaultOvertimeMultiplier" class="form-label">Overtime Multiplier</label>
            <input type="number" class="form-control" id="defaultOvertimeMultiplier" name="defaultOvertimeMultiplier" step="0.1" min="1" value="<%= employee ? (employee.defaultOvertimeMultiplier || 1.5) : '1.5' %>">
            <small class="form-text text-muted">Default: 1.5 (time and a half)</small>
          </div>
        </div>

        <div class="mb-3">
          <label for="notes" class="form-label">Notes</label>
          <textarea class="form-control" id="notes" name="notes" rows="4"><%= employee ? employee.notes : '' %></textarea>
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">Save Employee</button>
          <a href="<%= employee ? `/employees/${employee._id}` : '/employees' %>" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  function togglePayFields() {
    const hourlyCheckbox = document.getElementById('payTypeHourly');
    const salaryCheckbox = document.getElementById('payTypeSalary');
    const percentageCheckbox = document.getElementById('payTypePercentage');
    const hourlyFields = document.getElementById('hourlyFields');
    const salaryFields = document.getElementById('salaryFields');
    const percentageFields = document.getElementById('percentageFields');
    const hourlyRate = document.getElementById('hourlyRate');
    const annualSalary = document.getElementById('annualSalary');
    const percentageRate = document.getElementById('percentageRate');
    
    // Show/hide fields based on checkboxes
    if (hourlyCheckbox.checked) {
      hourlyFields.style.display = 'flex';
      hourlyRate.required = true;
    } else {
      hourlyFields.style.display = 'none';
      hourlyRate.required = false;
    }
    
    if (salaryCheckbox.checked) {
      salaryFields.style.display = 'flex';
      annualSalary.required = true;
    } else {
      salaryFields.style.display = 'none';
      annualSalary.required = false;
    }
    
    if (percentageCheckbox.checked) {
      percentageFields.style.display = 'flex';
      percentageRate.required = true;
    } else {
      percentageFields.style.display = 'none';
      percentageRate.required = false;
    }
  }
  
  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    togglePayFields();
  });
</script>

<%- include('../partials/footer') %>

